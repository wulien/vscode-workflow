---
name: multi-agent-collaboration
description: 当任务可以分解为多个独立子任务时使用。利用 VS Code 多代理能力并行处理。
---

# 多 Agent 协作 Skill

## 概述

利用 VS Code 1.109.0 的多代理能力，将大任务分解为独立子任务并行处理，提高效率和质量。

## 触发条件

- 3+ 个独立的子任务需要处理
- 多个不相关的文件/模块需要修改
- 可以同时进行多个调查/分析
- 需要将任务委托给后台代理

## 代理类型

### 本地代理（Local Agent）

**特点：** 快速响应，上下文保持

**适用于：**
- 代码补全
- 简单重构
- 格式化
- 内联问答 (Ctrl+I)

### 云端代理（Cloud Agent）

**特点：** 强大的推理能力，复杂任务

**适用于：**
- 架构设计
- 复杂算法实现
- 全面代码审查
- 大规模重构规划

### 后台代理（Background Agent）

**特点：** 异步执行，不阻塞工作

**适用于：**
- 长时间运行的任务
- 批量代码迁移
- 大规模测试执行
- 依赖更新

## 协作模式

### 模式 1: 并行分派

**场景：** 多个独立域需要同时修复/实现

```
判断流程:
1. 多个任务？ → 是
2. 任务独立？ → 是（不共享状态）
3. 可以并行？ → 是（不互相依赖）
→ 使用并行分派
```

**步骤：**

1. **识别独立域**
   ```
   域 A: 用户模块 — Agent 1
   域 B: 订单模块 — Agent 2
   域 C: 支付模块 — Agent 3
   ```

2. **创建聚焦的 Agent 任务**
   每个 Agent 获得：
   - 明确的范围
   - 清晰的目标
   - 约束条件
   - 预期输出格式

3. **分派执行**
   - 委托到后台代理或新聊天会话
   - 每个 Agent 独立工作

4. **审查和集成**
   - 检查每个 Agent 的输出
   - 确认没有冲突
   - 运行完整测试
   - 集成所有变更

### 模式 2: 子代理驱动开发

**场景：** 按计划逐任务执行，每个任务由独立代理完成

```
控制器（你）读取计划
    ↓
为 Task 1 分派 实现代理
    ↓
实现代理完成 → 分派 审查代理
    ↓
审查通过 → 标记完成
    ↓
为 Task 2 分派 实现代理
    ↓
... 重复直到所有任务完成
```

**每个任务的流程：**

1. **分派实现代理**
   ```
   任务: [完整的任务描述]
   文件: [需要修改的文件]
   要求: 遵循 TDD，完成后自查
   ```

2. **分派规格审查代理**
   ```
   审查: 代码是否满足任务规格？
   标准: 不多不少，精确匹配需求
   ```

3. **分派质量审查代理**
   ```
   审查: 代码质量、可维护性、测试覆盖
   ```

4. **审查通过 → 下一个任务**

### 模式 3: 设计-实现分离

**场景：** 复杂功能需要先设计后实现

```
设计代理: 架构设计和方案评审
    ↓
验证: 用户确认设计
    ↓
规划代理: 生成实现计划
    ↓
实现代理: 逐任务执行
    ↓
审查代理: 质量把关
```

## Agent 提示模板

### 实现代理提示

```markdown
你是一个精确的实现代理。遵循以下规则：

**任务:** [task 描述]
**文件:** [文件列表]
**要求:**
1. 遵循 TDD: 先写测试，确认失败，再实现
2. 最小实现: 只做任务要求的，不多
3. 自查: 完成后自我审查
4. 提交: 每个步骤完成后提交

**输出:** 实现结果的摘要
```

### 审查代理提示

```markdown
你是一个严格的代码审查代理。

**审查内容:** [变更描述]
**对照标准:** [需求/计划]
**检查维度:**
1. 规格符合度 — 实现是否匹配需求
2. 代码质量 — 可读性、可维护性
3. 测试覆盖 — 是否充分
4. 安全性 — 是否有漏洞

**输出格式:**
- Critical/Important/Minor 分级
- 每个问题: 文件:行号, 问题, 原因, 修复建议
- 总体评估: 是否可以合并
```

## VS Code 中的实践

### 利用多聊天窗口

1. **主窗口** — 协调和规划
2. **内联聊天 (Ctrl+I)** — 快速代码编辑
3. **侧面板聊天** — 深度讨论和审查
4. **后台代理** — 长时间任务委托

### 利用 Todo 跟踪

使用 Copilot 的 Todo 管理功能跟踪多代理进度：
```
Todo 1: [实现模块 A] - Agent 1 执行中
Todo 2: [实现模块 B] - Agent 2 完成
Todo 3: [审查模块 B] - Agent 3 执行中
Todo 4: [实现模块 C] - 等待中
```

## 红线

- **绝不** 让多个 Agent 同时修改同一个文件
- **绝不** 跳过集成后的完整测试
- **绝不** 信任 Agent 的 "完成" 报告（必须验证）
- **绝不** 在没有审查的情况下合并 Agent 的输出
