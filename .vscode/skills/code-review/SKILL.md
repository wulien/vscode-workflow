---
name: code-review
description: 在完成任务后、合并代码前使用。对代码变更进行系统化审查。
---

# 代码审查 Skill

## 概述

每次提交前和合并前的系统化代码审查流程。AI 审查不是替代人工审查，而是第一道防线。

## 触发条件

- 完成一个功能/任务后
- 合并代码前
- PR 审查时
- 被要求审查代码时

## 审查方式

### 1. 请求 AI 审查

**使用 VS Code Copilot Chat：**

```
请审查以下代码变更：

审查范围：
- git diff [base]...[head]

审查维度：
1. 正确性 — 逻辑是否正确
2. 安全性 — 是否有安全漏洞
3. 性能 — 是否有性能问题
4. 可维护性 — 代码是否易于理解和修改
5. 测试覆盖 — 测试是否充分
6. 需求符合度 — 是否满足原始需求
```

### 2. 审查输出格式

```markdown
### 优点
[做得好的地方]

### 问题

#### Critical (必须修复)
[Bug、安全问题、数据丢失风险]

#### Important (应该修复)
[架构问题、缺失功能、错误处理不足]

#### Minor (建议修复)
[代码风格、优化建议、文档改进]

### 评估

**是否可以合并:** [是/否/修复后可以]
**理由:** [Technical assessment]
```

### 3. 处理审查结果

| 级别 | 处理方式 |
|------|----------|
| Critical | 立即修复，不可合并 |
| Important | 合并前修复 |
| Minor | 记录为后续优化 |

### 4. 如果审查者的建议有误

- 用技术论据反驳
- 展示代码/测试证明
- 请求澄清

## 审查检查清单

```
代码审查检查清单：
- [ ] 代码质量
  - [ ] 关注点分离合理？
  - [ ] 错误处理完整？
  - [ ] 类型安全？
  - [ ] DRY 原则？
  - [ ] 边界条件处理？

- [ ] 架构
  - [ ] 设计决策合理？
  - [ ] 可扩展性？
  - [ ] 性能影响？
  - [ ] 安全考虑？

- [ ] 测试
  - [ ] 测试真正测试了逻辑（不是只测 mock）？
  - [ ] 边界条件覆盖？
  - [ ] 集成测试（如需要）？
  - [ ] 所有测试通过？

- [ ] 需求
  - [ ] 所有计划需求已满足？
  - [ ] 实现符合设计？
  - [ ] 没有范围蔓延？

- [ ] 生产准备
  - [ ] 迁移策略（如有 schema 变更）？
  - [ ] 向后兼容？
  - [ ] 文档完整？
```

## 接收审查反馈

**做法：**
- 先理解反馈
- 一次处理一项
- 每项修复后都运行测试
- 确认没有引入新问题

**不要：**
- 盲目同意所有建议
- 一次性批量修改
- 跳过验证
- 回避推回
